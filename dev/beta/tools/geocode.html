<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Geocoder</title>
    <!-- Include Bootstrap CSS from a CDN for layout and dark theme -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Include Leaflet CSS and JS from a CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Custom CSS for the light theme and layout -->
    <style>
        /* Apply a light theme to the body and remove default margins */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            color: #212529;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Style the map container to fill the screen */
        #map {
            width: 100%;
            height: 100%;
            z-index: 1;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        /* Style the result box to appear over the map */
        .result-box {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            max-width: 400px;
            background-color: rgba(240, 240, 240, 0.9);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 10;
            display: none; /* Initially hidden */
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            border: 1px solid #ddd;
            text-align: center; /* Aligns all text inside the box to the center */
        }

        .result-box.visible {
            display: block;
            opacity: 1;
        }

        /* Styling for the content within the result box */
        .result-box h2 {
            margin-top: 0;
            font-size: 1.2em;
            color: #212529;
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
        }

        .result-box p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        .result-box strong {
            color: #212529;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 600px) {
            .result-box {
                top: 10px;
                padding: 15px;
            }
        }
    </style>
</head>
<body class="bg-light text-dark">

    <!-- Map container -->
    <div id="map"></div>

    <!-- Container for displaying API results -->
    <div id="resultBox" class="result-box">
        <h2>Location Details</h2>
        <div id="resultContent"></div>
    </div>

    <!-- Bootstrap JS, if needed for components (though not for this simple layout) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Use an IIFE for encapsulation
        (function() {
            // Wait for the DOM to be fully loaded
            document.addEventListener('DOMContentLoaded', () => {

                // Define constants for the API key and device ID
                const API_KEY = "dd8770c04bfc20b2f1885e5f1c901125";
                const DEVICE_ID = "011006FD-129A-458E-8A98-7283010A3558";

                // Initialize the Leaflet map and set its initial view.
                // Using a light-themed tile layer from CartoDB.
                const map = L.map('map').setView([53.388, -2.288], 13);
                const lightTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                    subdomains: 'abcd',
                    maxZoom: 20,
                }).addTo(map);

                // Variables for the marker and result box elements
                let marker = null;
                const resultBox = document.getElementById('resultBox');
                const resultContent = document.getElementById('resultContent');

                // Add a click listener to the map
                map.on('click', async (e) => {
                    const { lat, lng } = e.latlng;

                    // Remove existing marker if it exists
                    if (marker) {
                        map.removeLayer(marker);
                    }

                    // Add a new marker at the clicked location
                    marker = L.marker([lat, lng]).addTo(map);
                    
                    // Show a "Loading..." message and make the box visible
                    resultContent.innerHTML = "<p><strong>Loading...</strong></p>";
                    resultBox.classList.add('visible');

                    // Construct the API URL using the clicked coordinates
                    const apiUrl = `https://app.owm.io/app/1.1/geo/reverse?lat=${lat}&lon=${lng}&appid=${API_KEY}&deviceid=${DEVICE_ID}`;

                    try {
                        // Fetch the data from the API
                        const response = await fetch(apiUrl);
                        
                        // Check if the response was successful
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        // Parse the JSON response
                        const data = await response.json();
                        
                        // Check if the response is an array and contains at least one result
                        if (Array.isArray(data) && data.length > 0) {
                            const firstResult = data[0];
                            resultContent.innerHTML = `
                                <p><strong>Full Name:</strong> ${firstResult.full_name || 'N/A'}</p>
                            `;
                        } else {
                            // Handle cases where no location data is found
                            resultContent.innerHTML = "<p>No detailed location data found for this spot.</p>";
                        }

                    } catch (error) {
                        // Log the error and display a user-friendly message
                        console.error('Error fetching geocoding data:', error);
                        resultContent.innerHTML = "<p>An error occurred. Please try again.</p>";
                    }
                });
            });
        })();
    </script>
</body>
</html>
